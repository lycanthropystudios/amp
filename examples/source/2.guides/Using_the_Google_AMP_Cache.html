<!---

hideCode: true
disablePlayground: true
hidePreview: true
author: kul3r4

--->

<!--
  ## Introduction

  The [Google AMP Cache](https://developers.google.com/amp/cache/overview) stores valid AMPs and provides a consistently fast access to AMPs. It is available for anyone to use.
-->
<!-- -->
<!doctype html>
<html âš¡>
<head>
  <meta charset="utf-8">
  <title>Using the Google AMP Cache</title>
  <script async src="https://cdn.ampproject.org/v0.js"></script>
  <link rel="canonical" href="<% canonical %>">
  <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">
  <style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>
</head>
<body>
  <!--
## AMP Cache URL Format

When possible, the Google AMP Cache will create a subdomain for each AMP document's domain by first converting it from [IDN (punycode)](https://en.wikipedia.org/wiki/Punycode) to UTF-8. The caches replaces every `-` (dash) with `--` (2 dashes) and replace every `.` (dot) with `-` (dash). For example, `pub.com` will map to `pub-com.cdn.ampproject.org`.

Here is AMP Cache URL for `https://amp.dev/about/websites/`:

{% do doc.amp_dependencies.add('amp-iframe', '0.1') %}
<div>
<amp-iframe title="Google AMP Cache tool" height="105" layout="fixed-height" sandbox="allow-scripts allow-popups" src="/static/samples/files/amp-url-converter.html?url=https://amp.dev/about/websites/">
<div placeholder></div>
</amp-iframe>
</div>

The converted AMP Cache URL consists of the following parts:

* `amp-dev`: the publisher domain converted into a subdomain using the algorithm described above.</li>
* `cdn.ampproject.org`: the AMP Cache domain.
* `c`: to indicate that it's an AMP document (there is also `i` for image and `r` for resources such as fonts).
* `s`: indicating that the AMP Cache fetches the content from the origin using TLS (secure HTTPS).
* `amp.dev/examples/components/amp-img`: the original URL excluding the scheme.

It is OK for URLs to include parameters in the query string, simply include these in the AMP Cache URL as well.

Example: [https://amp-dev.cdn.ampproject.org/c/s/amp.dev/documentation/examples/api/query?value=Hello%20World](https://amp-dev.cdn.ampproject.org/c/s/amp.dev/documentation/examples/api/query?value=Hello%20World).

## Cache updates

The AMP Cache uses a [one-behind caching model](https://developers.google.com/amp/cache/overview#google-amp-cache-updates) which can be controlled by the [`max-age` cache directive](https://developer.mozilla.org/de/docs/Web/HTTP/Headers/Cache-Control). You can test the behavior with this sample page, which will prints the current date at serving time:

Max-age 15s: [https://amp-dev.cdn.ampproject.org/c/s/amp.dev/documentation/examples/api/query?maxage=15](https://amp-dev.cdn.ampproject.org/c/s/amp.dev/documentation/examples/api/query?maxage=15).

## Redirect & Error Handling

Here are some examples for how the AMP Cache handles redirects and errors:

**Redirects**

The AMP Cache follows redirects when resolving AMP URLs. For example, if an URL redirects to another AMP URL:

```
$ curl -I https://ampbyexample.com/components/amp-img/

HTTP/1.1 301 Moved Permanently
Content-Type: text/html; charset=utf-8
Location: https://amp.dev/documentation/examples/components/amp-img/
...
```

Then the AMP Cache will return the content of the resolved redirect for the original URL.

Example: [https://amp-dev.cdn.ampproject.org/c/s/ampbyexample.com/components/amp-img/](https://cdn.ampproject.org/c/s/ampbyexample.com/components/amp-img/).

Important: If you move the location of the AMP Files on your server, make sure to set up a redirect from the old location to the new one.

**Not Found**

When a page is not found in the AMP Cache, it will show an error page and return a 404 status.

Example: [https://amp-dev.cdn.ampproject.org/amp.dev/not-found](https://cdn.ampproject.org/c/s/amp.dev/not-found)

**Invalid AMP**

When a page is invalid AMP, the AMP Cache will return a 404 status.</p>

Example: [https://amp-dev.cdn.ampproject.org/amp.dev/static/samples/files/invalid_amp.html](https://cdn.ampproject.org/c/s/amp.dev/static/samples/files/invalid_amp.html)

**Server Errors**

If an URL returns a 5XX server errors, the AMP Cache will return a 404 status.</p>

Example: [https://amp-dev.cdn.ampproject.org/amp.dev/documentation/examples/api/error](https://cdn.ampproject.org/c/s/amp.dev/documentation/examples/api/error)

-->
</body>
</html>
